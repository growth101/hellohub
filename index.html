<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HelloHub - Alex Davis Care Group</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px;
            position: relative;
            transition: all 0.5s ease;
        }
        
        /* Background images for each location */
        body.location-the-royal {
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('the-royal-exterior.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        body.location-the-crown {
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('the-crown-exterior.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        body.location-seabreeze {
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('seabreeze-exterior.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        /* Remove the old Alex Davis logo background when location photos are shown */
        body.location-the-royal::before,
        body.location-the-crown::before,
        body.location-seabreeze::before {
            display: none;
        }
        
        body.alex-davis-logged-in::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw;
            height: 45vw;
            max-width: 800px;
            max-height: 400px;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDQwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxlbGxpcHNlIGN4PSIyMDAiIGN5PSIxMDAiIHJ4PSIxOTAiIHJ5PSI5MCIgZmlsbD0iIzAwMDAwMCIgc3Ryb2tlPSIjQzBDMEMwIiBzdHJva2Utd2lkdGg9IjMiLz4KPHN2ZyB4PSI1MCIgeT0iMzAiIHdpZHRoPSIzMDAiIGhlaWdodD0iMTQwIj4KICA8IS0tIENyb3duIC0tPgogIDxwYXRoIGQ9Ik0yNTAgNDAgTDI2MCAzMCBMMjcwIDQwIEwyNjggNTAgTDI3MCA2MCBMMjYwIDUwIEwyNTAgNjAiIGZpbGw9IiNEQUE1MjAiLz4KICA8IS0tIEFsZXhEYXZpcyBUZXh0IC0tPgogIDx0ZXh0IHg9IjE1IiB5PSI4NSIgZm9udC1mYW1pbHk9InNlcmlmIiBmb250LXNpemU9IjM2IiBmb250LXN0eWxlPSJpdGFsaWMiIGZpbGw9IndoaXRlIj5BbGV4RGF2aXM8L3RleHQ+CiAgPCEtLSBIYW5kIC0tPgogIDxwYXRoIGQ9Ik0xMDAgMTEwIEwxMzAgMTAwIEwxNDUgMTA1IEwxNTAgMTEwIEwxNDUgMTE1IEwxMzAgMTIwIEwxMDAgMTMwIFoiIGZpbGw9IiNEQUE1MjAiLz4KICA8IS0tIENBUkUgR1JPVVAgVGV4dCAtLT4KICA8dGV4dCB4PSI4MCIgeT0iMTI1IiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiBsZXR0ZXItc3BhY2luZz0iM3B4Ij5DQVJFIEJST1VQPC90ZXh0Pgo8L3N2Zz4KPC9zdmc+');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.25;
            z-index: -1;
            pointer-events: none;
        }
        .container {
            background: rgba(255, 255, 255, 0.5); border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            max-width: 500px; width: 100%; min-height: 600px; position: relative;
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .header {
            background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; padding: 40px 30px; text-align: center; border-radius: 20px 20px 0 0;
            position: relative;
        }
        .header h1 { font-size: 24px; margin-bottom: 8px; opacity: 0.9; font-weight: 600; }
        .header p { opacity: 1; font-size: 36px; font-weight: bold; margin-bottom: 8px; }
        .header .location-name { font-size: 42px; font-weight: bold; opacity: 1; margin-top: 8px; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .header .company-logo {
            max-height: 80px;
            max-width: 280px;
            width: auto;
            height: auto;
            margin-bottom: 20px;
            object-fit: contain;
            display: none;
        }
        .content { padding: 40px; position: relative; min-height: 400px; }
        .admin-logo {
            position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%);
            cursor: pointer; user-select: none; z-index: 100;
        }
        .page { display: none; }
        .page.active { display: block; }
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 14px; }
        .required { color: #e74c3c; }
        input, select {
            width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 12px;
            font-size: 16px; background: #f8f9fa; transition: all 0.3s ease;
        }
        input:focus, select:focus {
            outline: none; border-color: #74b9ff; background: white; box-shadow: 0 0 0 3px rgba(116, 185, 255, 0.1);
        }
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold;
            cursor: pointer; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s ease;
        }
        .btn-primary { background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; }
        .btn-success { background: linear-gradient(135deg, #00b894, #00a085); color: white; }
        .btn-warning { background: linear-gradient(135deg, #fdcb6e, #e17055); color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn:hover { transform: translateY(-2px); }
        .user-type-selection { display: flex; gap: 10px; margin-bottom: 30px; }
        .user-type-btn {
            flex: 1; padding: 20px; border: 2px solid #e0e0e0; border-radius: 12px; background: #f8f9fa;
            cursor: pointer; text-align: center; transition: all 0.3s ease;
        }
        .user-type-btn:hover { border-color: #74b9ff; background: white; }
        .user-type-btn.active { border-color: #74b9ff; background: linear-gradient(135deg, #74b9ff, #0984e3); color: white; }
        .alert { padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .alert-success { background: #d1f2eb; color: #00695c; border: 1px solid #a7f3d0; }
        .alert-info { background: #e3f2fd; color: #0277bd; border: 1px solid #b3e5fc; }
        .countdown { margin-top: 15px; font-size: 16px; font-weight: bold; color: #0277bd; }
        
        /* Feedback Form Styles */
        .feedback-question {
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.06);
        }
        
        .feedback-label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .star-rating {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .star {
            font-size: 32px;
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.3;
            transform: scale(1);
        }
        
        .star:hover {
            transform: scale(1.1);
            opacity: 0.8;
        }
        
        .star.selected {
            opacity: 1;
            filter: drop-shadow(0 2px 4px rgba(255, 193, 7, 0.3));
        }
        
        .star.selected ~ .star {
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="alex-davis-logo.png" alt="Alex Davis Care Group Logo" class="company-logo" id="headerLogo">
            <h1 id="headerTitle">üëã HelloHub</h1>
            <p id="headerSubtitle">Visitor, Client & Staff Management</p>
            <div id="locationName" class="location-name" style="display: none;"></div>
        </div>
        <div class="content">
            <div class="admin-logo" onclick="adminReset()">
                <svg width="80" height="50" viewBox="0 0 400 200">
                    <rect x="20" y="40" width="200" height="120" rx="25" ry="25" fill="#000000"/>
                    <circle cx="120" cy="85" r="15" fill="white"/>
                    <ellipse cx="120" cy="120" rx="12" ry="20" fill="white"/>
                    <path d="M140 95 Q148 90 152 95 Q156 100 150 105 Q144 110 140 105 Q136 100 140 95" fill="white"/>
                    <path d="M50 160 L35 180 L65 160 Z" fill="#000000"/>
                    <text x="250" y="110" font-family="Arial" font-size="32" font-weight="bold" fill="#000000">HelloHub</text>
                </svg>
            </div>

            <div id="loginPage" class="page active">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Company Login</h2>
                <div class="form-group">
                    <label for="emailAddress">Email Address:</label>
                    <input type="email" id="emailAddress" placeholder="Enter your company email">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                <button class="btn btn-primary" onclick="doLogin()">üîê Login</button>
                <div id="loginError" style="display: none; color: #e74c3c; text-align: center; margin-top: 15px; font-size: 14px;"></div>
            </div>

            <div id="businessSelect" class="page">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Select Location</h2>
                <div class="form-group">
                    <label for="businessDropdown">Choose Business Location:</label>
                    <select id="businessDropdown" onchange="doSelectBusiness()">
                        <option value="">-- Select Location --</option>
                    </select>
                </div>
            </div>

            <div id="userTypeSelect" class="page">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">I am a...</h2>
                <div class="user-type-selection">
                    <div class="user-type-btn" onclick="doSelectUserType('visitor')">
                        <div style="font-size: 24px; margin-bottom: 10px;">üë•</div>
                        <div style="font-weight: bold;">Visitor</div>
                    </div>
                    <div class="user-type-btn" onclick="doSelectUserType('client')">
                        <div style="font-size: 24px; margin-bottom: 10px;">ü§ù</div>
                        <div style="font-weight: bold;">Client</div>
                    </div>
                    <div class="user-type-btn" onclick="doSelectUserType('staff')">
                        <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíº</div>
                        <div style="font-weight: bold;">Staff</div>
                    </div>
                </div>
                <div style="display: flex; gap: 15px;">
                    <button class="btn btn-primary" onclick="doShowAction('arriving')">Arriving</button>
                    <button class="btn btn-warning" onclick="doShowAction('leaving')">Leaving</button>
                </div>
            </div>

            <div id="arrivingPage" class="page">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Arriving</h2>
                <div id="arrivalForm"></div>
            </div>

            <div id="leavingPage" class="page">
                <!-- Content will be dynamically generated -->
            </div>

            <div id="feedbackPage" class="page">
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Your Feedback Matters</h2>
                <div class="alert alert-info">Please rate the care home in terms of number of stars, with 5 stars being best</div>
                
                <form id="feedbackForm">
                    <div class="feedback-question">
                        <label class="feedback-label">How would you rate the care home overall?</label>
                        <div class="star-rating" data-question="overall">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you feel the care home keeps people safe?</label>
                        <div class="star-rating" data-question="safety">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you feel the care home is responsive to people's needs?</label>
                        <div class="star-rating" data-question="responsive">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you feel the care home is caring towards people?</label>
                        <div class="star-rating" data-question="caring">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you feel the care home is well-led?</label>
                        <div class="star-rating" data-question="leadership">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you feel the care provided is effective?</label>
                        <div class="star-rating" data-question="effectiveness">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>

                    <div class="feedback-question">
                        <label class="feedback-label">Do you have any other feedback about your visit?</label>
                        <textarea id="additionalFeedback" placeholder="Please share any additional comments..." 
                                rows="4" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: Arial, sans-serif; font-size: 14px; resize: vertical; margin-top: 8px;"></textarea>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="button" class="btn btn-success" onclick="doSubmitFeedback()">‚úÖ Submit Feedback</button>
                    </div>
                </form>
            </div>

            <div id="successPage" class="page">
                <!-- Personal Message Box - Large and Eye-catching -->
                <div class="alert" style="background: linear-gradient(135deg, #d4f6d4 0%, #c8e6c9 100%); color: #2e7d32; border: 2px solid #a5d6a7; padding: 25px; margin-bottom: 15px; font-size: 18px; font-weight: bold; text-align: center; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <div id="successMsg" style="font-size: 20px; margin-bottom: 5px;"></div>
                </div>
                
                <!-- System Message Box - Smaller and Subtle -->
                <div class="alert" style="background: #f8f9fa; color: #6c757d; border: 1px solid #dee2e6; padding: 12px; font-size: 13px; text-align: center; border-radius: 8px;">
                    <div id="successDetails"></div>
                    <div id="countdown" class="countdown"></div>
                </div>
            </div>
        </div>
    </div>

   <script>
    // Disable console logs in production
    (function() {
        if (window.location.protocol === 'https:' || window.location.hostname !== 'localhost') {
            console.log = function() {};
            console.warn = function() {};
            console.error = function() {};
            console.info = function() {};
            console.debug = function() {};
        }
    })();

    // Global variables
        let APP = {
            company: '',
            locations: [],
            currentBusiness: '',
            currentUserType: '',
            adminClicks: 0
        };
        let currentDepartingVisitor = null;

        // Supabase configuration
        const VISITOR_CONFIG = {
            supabaseUrl: 'https://obyzwhqaqyiqpeoefjgw.supabase.co',
            supabaseAnonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ieXp3aHFhcXlpcXBlb2Vmamd3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwMDY0MDAsImV4cCI6MjA2NzU4MjQwMH0.NaePwt-LGqNp4vc8TTcv3IyzFkamZtiHmvDLpDcliAc'
        };

        function doLogin() {
            console.log('Login function called');
            const email = document.getElementById('emailAddress').value.trim().toLowerCase();
            const password = document.getElementById('password').value.trim();
            
            console.log('Attempting login with:', email, password);
            
            if (!email || !password) {
                showError('Please enter both email and password.');
                return;
            }
            
            if (email === 'office@alexdavis.co.uk' && password === 'office927') {
    console.log('Login successful!');
    console.log('Valid credentials: office@alexdavis.co.uk / office927');
    APP.company = 'Alex Davis Care Group';
                APP.locations = ['The Royal', 'The Crown', 'Seabreeze'];
                
                document.getElementById('emailAddress').value = '';
                document.getElementById('password').value = '';
                hideError();
                
                setupBusinessDropdown();
                showPage('businessSelect');
                saveSessionState(); // Save state when going to location selection
            } else {
                console.log('Login failed');
                showError('Invalid email or password.');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('loginError').style.display = 'none';
        }

        function setupBusinessDropdown() {
            const dropdown = document.getElementById('businessDropdown');
            dropdown.innerHTML = '<option value="">-- Select Location --</option>';
            
            APP.locations.forEach((loc, i) => {
                const opt = document.createElement('option');
                opt.value = `loc-${i}`;
                opt.textContent = loc;
                dropdown.appendChild(opt);
            });
        }

        function doSelectBusiness() {
            APP.currentBusiness = document.getElementById('businessDropdown').value;
            if (APP.currentBusiness) {
                updateHeader(); // This will now show the location name
                showPage('userTypeSelect');
                saveSessionState(); // Save state after everything is updated
            }
        }

        function updateHeader() {
            const logo = document.getElementById('headerLogo');
            const locationDiv = document.getElementById('locationName');
            
            if (APP.company === 'Alex Davis Care Group') {
                // Show company branding when logged in
                document.getElementById('headerTitle').textContent = `Alex Davis Care Group`;
                document.getElementById('headerSubtitle').textContent = ``;
                
                // Show and setup logo with logout functionality
                logo.style.display = 'block';
                logo.onmousedown = startLogoutTimer;
                logo.onmouseup = cancelLogoutTimer;
                logo.onmouseleave = cancelLogoutTimer;
                logo.ontouchstart = startLogoutTimer;
                logo.ontouchend = cancelLogoutTimer;
                
                document.body.classList.add('alex-davis-logged-in');
                
                // Only show location name and background if location is selected
                if (APP.currentBusiness) {
                    const locationName = getLocationName();
                    if (locationName) {
                        locationDiv.textContent = locationName;
                        locationDiv.style.display = 'block';
                        
                        // Add location-specific background class
                        const location = locationName.toLowerCase().replace(/\s+/g, '-');
                        document.body.classList.add(`location-${location}`);
                    }
                } else {
                    // On location selection page - no location name yet
                    locationDiv.style.display = 'none';
                    document.body.classList.remove('location-the-royal', 'location-the-crown', 'location-seabreeze');
                }
            } else {
                // Default state - not logged in
                document.body.classList.remove('alex-davis-logged-in');
                document.body.classList.remove('location-the-royal', 'location-the-crown', 'location-seabreeze');
                logo.style.display = 'none';
                locationDiv.style.display = 'none';
            }
        }

        function getLocationName() {
            const idx = parseInt(APP.currentBusiness.replace('loc-', ''));
            return APP.locations[idx] || '';
        }

        function doSelectUserType(type) {
            APP.currentUserType = type;
            document.querySelectorAll('.user-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.user-type-btn').classList.add('active');
            saveSessionState(); // Add session saving here
        }

        function doShowAction(action) {
            if (!APP.currentUserType) {
                alert('Please select your user type first.');
                return;
            }
            
            if (action === 'arriving') {
                buildArrivalForm();
                showPage('arrivingPage');
                saveSessionState(); // Save state when going to arriving page
            } else {
                buildDepartureForm();
                showPage('leavingPage');
                saveSessionState(); // Save state when going to leaving page
            }
        }

        function buildArrivalForm() {
            const form = document.getElementById('arrivalForm');
            let fields = '';
            
            if (APP.currentUserType === 'visitor') {
                fields = `
                    <div class="form-group">
                        <label>First Name: <span class="required">*</span></label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Surname: <span class="required">*</span></label>
                        <input type="text" id="surname" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="email" placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label>Mobile:</label>
                        <input type="tel" id="mobile" placeholder="04XX XXX XXX">
                    </div>
                `;
            } else {
                fields = `
                    <div class="form-group">
                        <label>First Name: <span class="required">*</span></label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label>Surname: <span class="required">*</span></label>
                        <input type="text" id="surname" required>
                    </div>
                `;
            }
            
            form.innerHTML = fields + `
                <button class="btn btn-success" onclick="doRecordArrival()">üíæ Record Arrival</button>
                <button class="btn btn-secondary" onclick="doGoBack()">‚Üê Back</button>
            `;
        }

        function buildDepartureForm() {
            document.getElementById('leavingPage').innerHTML = `
                <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Leaving</h2>
                <div class="alert alert-info">Enter your name to record departure:</div>
                <div class="form-group">
                    <label for="leaveFirst">First Name: <span class="required">*</span></label>
                    <input type="text" id="leaveFirst" required autocomplete="off" oninput="showNameSuggestions()" onblur="hideNameSuggestions()" onkeydown="handleSuggestionKeyboard(event)">
                    <div id="nameSuggestions" style="display: none; position: absolute; background: white; border: 1px solid #ccc; border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 1000; width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"></div>
                </div>
                <div class="form-group">
                    <label for="leaveLast">Surname: <span class="required">*</span></label>
                    <input type="text" id="leaveLast" required autocomplete="off">
                </div>
                <button class="btn btn-warning" onclick="doRecordDeparture()">Record Departure</button>
                <button class="btn btn-secondary" onclick="doGoBack()">‚Üê Back</button>
            `;
        }

        // Get list of people who arrived today and haven't departed yet
        function getCurrentArrivals() {
            const existingData = JSON.parse(localStorage.getItem('hellohubVisitors') || '[]');
            const today = new Date().toLocaleDateString();
            const currentLocation = getLocationName();
            const currentUserType = APP.currentUserType;
            
            return existingData.filter(person => 
                person.arrivalDate === today && 
                person.status === 'arrived' && 
                person.location === currentLocation &&
                person.userType === currentUserType
            );
        }

        // Show name suggestions as user types
        function showNameSuggestions() {
            const input = document.getElementById('leaveFirst');
            const suggestionsDiv = document.getElementById('nameSuggestions');
            const searchTerm = input.value.toLowerCase().trim();
            
            if (searchTerm.length < 1) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            const currentArrivals = getCurrentArrivals();
            const matches = currentArrivals.filter(person => 
                person.firstName.toLowerCase().includes(searchTerm)
            );
            
            if (matches.length === 0) {
                suggestionsDiv.style.display = 'none';
                return;
            }
            
            // Build suggestions HTML
            let suggestionsHTML = '';
            matches.forEach((person, index) => {
                const arrivalTime = person.arrivalTime || 'Unknown time';
                suggestionsHTML += `
                    <div class="suggestion-item" data-index="${index}" onclick="selectSuggestion('${person.firstName}', '${person.surname}')" 
                         style="padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; transition: background 0.2s ease;"
                         onmouseover="this.style.background='#f0f8ff'" onmouseout="this.style.background='white'">
                        <div style="font-weight: bold; color: #333;">${person.firstName} ${person.surname}</div>
                        <div style="font-size: 12px; color: #666;">Arrived: ${arrivalTime}</div>
                        <div style="font-size: 11px; color: #999;">${person.email !== 'Not provided' ? person.email : ''}</div>
                    </div>
                `;
            });
            
            suggestionsDiv.innerHTML = suggestionsHTML;
            suggestionsDiv.style.display = 'block';
            
            // Position the suggestions below the input
            const inputRect = input.getBoundingClientRect();
            suggestionsDiv.style.width = input.offsetWidth + 'px';
        }

        // Select a suggestion
        function selectSuggestion(firstName, surname) {
            document.getElementById('leaveFirst').value = firstName;
            document.getElementById('leaveLast').value = surname;
            hideNameSuggestions();
        }

        // Hide suggestions
        function hideNameSuggestions() {
            setTimeout(() => {
                const suggestionsDiv = document.getElementById('nameSuggestions');
                if (suggestionsDiv) {
                    suggestionsDiv.style.display = 'none';
                }
            }, 200); // Small delay to allow clicks to register
        }

        // Handle keyboard navigation in suggestions
        let selectedSuggestionIndex = -1;
        function handleSuggestionKeyboard(event) {
            const suggestionsDiv = document.getElementById('nameSuggestions');
            const suggestions = suggestionsDiv.querySelectorAll('.suggestion-item');
            
            if (suggestions.length === 0) return;
            
            switch(event.key) {
                case 'ArrowDown':
                    event.preventDefault();
                    selectedSuggestionIndex = (selectedSuggestionIndex + 1) % suggestions.length;
                    highlightSuggestion(suggestions);
                    break;
                case 'ArrowUp':
                    event.preventDefault();
                    selectedSuggestionIndex = selectedSuggestionIndex <= 0 ? suggestions.length - 1 : selectedSuggestionIndex - 1;
                    highlightSuggestion(suggestions);
                    break;
                case 'Enter':
                    event.preventDefault();
                    if (selectedSuggestionIndex >= 0 && suggestions[selectedSuggestionIndex]) {
                        suggestions[selectedSuggestionIndex].click();
                    }
                    break;
                case 'Escape':
                    hideNameSuggestions();
                    selectedSuggestionIndex = -1;
                    break;
            }
        }

        // Highlight selected suggestion
        function highlightSuggestion(suggestions) {
            suggestions.forEach((item, index) => {
                if (index === selectedSuggestionIndex) {
                    item.style.background = '#e3f2fd';
                    item.style.borderLeft = '3px solid #2196f3';
                } else {
                    item.style.background = 'white';
                    item.style.borderLeft = 'none';
                }
            });
        }

        function doRecordArrival() {
            const firstName = document.getElementById('firstName').value.trim();
            const surname = document.getElementById('surname').value.trim();
            
            if (!firstName || !surname) {
                alert('Please enter both first name and surname.');
                return;
            }

            const email = document.getElementById('email') ? document.getElementById('email').value.trim() : '';
            const mobile = document.getElementById('mobile') ? document.getElementById('mobile').value.trim() : '';

            const data = {
                firstName: firstName,
                surname: surname,
                email: email || 'Not provided',
                mobile: mobile || 'Not provided',
                userType: APP.currentUserType,
                location: getLocationName(),
                arrivalDate: new Date().toLocaleDateString(),
                arrivalTime: new Date().toLocaleTimeString(),
                status: 'arrived',
                timestamp: new Date().toISOString()
            };

            saveToStorage(data);
            showSuccess(`üéâ Welcome, ${firstName} ${surname}!`, `Your arrival has been recorded as a ${APP.currentUserType}.`);
        }

        function doRecordDeparture() {
            const firstName = document.getElementById('leaveFirst').value.trim();
            const surname = document.getElementById('leaveLast').value.trim();
            
            if (!firstName || !surname) {
                alert('Please enter both first name and surname.');
                return;
            }

            currentDepartingVisitor = {
                firstName: firstName,
                surname: surname,
                email: 'Not provided',
                mobile: 'Not provided',
                userType: APP.currentUserType,
                location: getLocationName(),
                departureDate: new Date().toLocaleDateString(),
                departureTime: new Date().toLocaleTimeString(),
                status: 'departed',
                timestamp: new Date().toISOString()
            };

            if (APP.currentUserType === 'visitor') {
                showPage('feedbackPage');
                setupStarRatings();
                saveSessionState(); // Save state when on feedback page
            } else if (APP.currentUserType === 'staff') {
                saveToStorage(currentDepartingVisitor);
                showSuccess(`üòä Thank you for today ${firstName} ${surname}. You are the reason someone smiled today!`, 'Your departure has been recorded.');
            } else if (APP.currentUserType === 'client') {
                saveToStorage(currentDepartingVisitor);
                showSuccess(`‚òÄÔ∏è We hope you had the best day ${firstName} ${surname}, see you soon!`, 'Your departure has been recorded.');
            }
        }

        function setupStarRatings() {
            const starRatings = document.querySelectorAll('.star-rating');
            
            // First, reset all star ratings to fresh state
            starRatings.forEach(rating => {
                rating.dataset.selectedRating = '0'; // Reset to no rating
                const stars = rating.querySelectorAll('.star');
                stars.forEach(star => {
                    star.classList.remove('selected');
                    star.style.opacity = '0.3';
                    star.style.transform = 'scale(1)';
                });
            });
            
            starRatings.forEach(rating => {
                const stars = rating.querySelectorAll('.star');
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', function() {
                        const selectedRating = parseInt(this.dataset.rating);
                        
                        // Clear all stars first
                        stars.forEach(s => s.classList.remove('selected'));
                        
                        // Light up all stars from 1 to the selected rating
                        for (let i = 0; i < selectedRating; i++) {
                            stars[i].classList.add('selected');
                        }
                        
                        // Store the rating
                        rating.dataset.selectedRating = selectedRating;
                        
                        console.log(`Rated ${rating.dataset.question}: ${selectedRating} stars`);
                    });
                    
                    // Hover effect - show preview of what would be selected
                    star.addEventListener('mouseenter', function() {
                        const hoverRating = parseInt(this.dataset.rating);
                        stars.forEach((s, i) => {
                            if (i < hoverRating) {
                                s.style.opacity = '0.8';
                                s.style.transform = 'scale(1.05)';
                            } else {
                                s.style.opacity = '0.3';
                                s.style.transform = 'scale(1)';
                            }
                        });
                    });
                    
                    // Reset hover effect
                    star.addEventListener('mouseleave', function() {
                        const selectedRating = rating.dataset.selectedRating || 0;
                        stars.forEach((s, i) => {
                            if (i < selectedRating) {
                                s.style.opacity = '1';
                                s.style.transform = 'scale(1)';
                                s.classList.add('selected');
                            } else {
                                s.style.opacity = '0.3';
                                s.style.transform = 'scale(1)';
                                s.classList.remove('selected');
                            }
                        });
                    });
                });
            });
        }

        function doSubmitFeedback() {
            const ratings = {};
            const starRatings = document.querySelectorAll('.star-rating');
            
            starRatings.forEach(rating => {
                const questionName = rating.dataset.question;
                const selectedRating = rating.dataset.selectedRating || 0;
                ratings[questionName] = parseInt(selectedRating);
            });
            
            const additionalFeedback = document.getElementById('additionalFeedback').value.trim();
            
            currentDepartingVisitor.feedback = {
                overall: ratings.overall || 0,
                safety: ratings.safety || 0,
                responsive: ratings.responsive || 0,
                caring: ratings.caring || 0,
                leadership: ratings.leadership || 0,
                effectiveness: ratings.effectiveness || 0,
                additionalComments: additionalFeedback || 'No additional comments'
            };
            
            saveToStorage(currentDepartingVisitor);
            showSuccess(`üíù Thank you for visiting ${currentDepartingVisitor.firstName} ${currentDepartingVisitor.surname}, we value your feedback about our home.`, 'Your departure and feedback have been recorded.');
        }

        function doSkipFeedback() {
            saveToStorage(currentDepartingVisitor);
            showSuccess(`üëã Goodbye, ${currentDepartingVisitor.firstName} ${currentDepartingVisitor.surname}!`, 'Your departure has been recorded.');
        }

        function saveToStorage(data) {
            try {
                // Get existing data
                const existingData = JSON.parse(localStorage.getItem('hellohubVisitors') || '[]');
                
                // Check if this is a departure - try to find matching arrival record
                if (data.status === 'departed') {
                    const matchingIndex = findMatchingArrival(existingData, data);
                    
                    if (matchingIndex !== -1) {
                        console.log('Found matching arrival record, updating existing entry');
                        // Update the existing record with departure info
                        const existingRecord = existingData[matchingIndex];
                        
                        // Keep the original arrival data and add departure data
                        existingData[matchingIndex] = {
                            ...existingRecord, // Keep all original data (email, mobile, arrival times)
                            // Update with departure information
                            departureDate: data.departureDate,
                            departureTime: data.departureTime,
                            status: 'departed',
                            timestamp: data.timestamp, // Update timestamp to departure time
                            // Add feedback if it exists (only visitors provide feedback)
                            ...(data.feedback ? { feedback: data.feedback } : {})
                        };
                        
                        console.log('Updated existing record:', existingData[matchingIndex]);
                    } else {
                        console.log('No matching arrival found, creating new departure record');
                        // No matching arrival found, create new record
                        existingData.unshift(data);
                    }
                } else {
                    console.log('New arrival record');
                    // This is an arrival, just add it normally
                    existingData.unshift(data);
                }
                
                // Save back to localStorage
                localStorage.setItem('hellohubVisitors', JSON.stringify(existingData));
                
                // Prepare data for Supabase
                const latestRecord = data.status === 'departed' && findMatchingArrival(JSON.parse(localStorage.getItem('hellohubVisitors')), data) !== -1 
                    ? JSON.parse(localStorage.getItem('hellohubVisitors'))[findMatchingArrival(JSON.parse(localStorage.getItem('hellohubVisitors')), data)]
                    : data;
                
                const supabaseData = {
                    first_name: latestRecord.firstName,
                    surname: latestRecord.surname,
                    email: latestRecord.email || 'Not provided',
                    mobile: latestRecord.mobile || 'Not provided',
                    user_type: latestRecord.userType,
                    location: latestRecord.location,
                    status: latestRecord.status
                };

                // Only add arrival data if it exists
                if (latestRecord.arrivalDate) {
                    supabaseData.arrival_date = latestRecord.arrivalDate;
                }
                if (latestRecord.arrivalTime) {
                    supabaseData.arrival_time = latestRecord.arrivalTime;
                }

                // Only add departure data if it exists  
                if (latestRecord.departureDate) {
                    supabaseData.departure_date = latestRecord.departureDate;
                }
                if (latestRecord.departureTime) {
                    supabaseData.departure_time = latestRecord.departureTime;
                }

                // Only add feedback if it exists
                if (latestRecord.feedback) {
                    supabaseData.feedback_overall = latestRecord.feedback.overall;
                    supabaseData.feedback_safety = latestRecord.feedback.safety;
                    supabaseData.feedback_responsive = latestRecord.feedback.responsive;
                    supabaseData.feedback_caring = latestRecord.feedback.caring;
                    supabaseData.feedback_leadership = latestRecord.feedback.leadership;
                    supabaseData.feedback_effectiveness = latestRecord.feedback.effectiveness;
                    
                    // Calculate average rating manually
                    const ratings = [
                        latestRecord.feedback.overall,
                        latestRecord.feedback.safety,
                        latestRecord.feedback.responsive,
                        latestRecord.feedback.caring,
                        latestRecord.feedback.leadership,
                        latestRecord.feedback.effectiveness
                    ].filter(rating => rating > 0);
                    
                    const avgRating = ratings.length > 0 ? ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length : 0;
                    
                    supabaseData.feedback_average = avgRating;
                    supabaseData.feedback_comments = latestRecord.feedback.additionalComments || 'No additional comments';
                }
                
                console.log('Sending to Supabase:', JSON.stringify(supabaseData, null, 2));
                
                // For updates, we'd need to implement PUT/PATCH to Supabase
                // For now, we'll still POST each record separately
                fetch(`${VISITOR_CONFIG.supabaseUrl}/rest/v1/visitors`, {
                    method: 'POST',
                    headers: {
                        'apikey': VISITOR_CONFIG.supabaseAnonKey,
                        'Authorization': `Bearer ${VISITOR_CONFIG.supabaseAnonKey}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation'
                    },
                    body: JSON.stringify(supabaseData)
                })
                .then(response => {
                    console.log('Supabase response status:', response.status);
                    if (response.ok) {
                        return response.json().then(result => {
                            console.log('‚úÖ Data synced to Supabase successfully:', result);
                        });
                    } else {
                        return response.text().then(text => {
                            console.log('‚ö†Ô∏è Supabase sync failed:', response.status, text);
                        });
                    }
                })
                .catch(error => {
                    console.error('‚ö†Ô∏è Supabase sync failed:', error);
                    // Data is still saved locally, so continue normally
                });
                
                console.log('Data saved successfully to localStorage');
                return true;
            } catch (error) {
                console.log('Save failed:', error);
                return false;
            }
        }

        // Helper function to find matching arrival record for departure
        function findMatchingArrival(existingData, departureData) {
            // Look for a matching person who has arrived but not yet departed
            // Match based on name, user type, and location on the same day
            const departureDate = departureData.departureDate;
            
            for (let i = 0; i < existingData.length; i++) {
                const record = existingData[i];
                
                // Check if names match (case insensitive, flexible matching)
                const firstNameMatch = record.firstName.toLowerCase().trim() === departureData.firstName.toLowerCase().trim();
                const surnameMatch = record.surname.toLowerCase().trim() === departureData.surname.toLowerCase().trim();
                
                // Check other criteria
                const userTypeMatch = record.userType === departureData.userType;
                const locationMatch = record.location === departureData.location;
                const statusMatch = record.status === 'arrived'; // Only match with arrivals
                const sameDayMatch = record.arrivalDate === departureDate; // Same day
                
                if (firstNameMatch && surnameMatch && userTypeMatch && locationMatch && statusMatch && sameDayMatch) {
                    console.log('Found matching arrival:', record);
                    return i;
                }
            }
            
            console.log('No matching arrival found for:', departureData.firstName, departureData.surname);
            return -1; // No match found
        }

        function showSuccess(personalMessage, systemMessage) {
            document.getElementById('successMsg').textContent = personalMessage;
            document.getElementById('successDetails').textContent = systemMessage;
            showPage('successPage');
            saveSessionState(); // Save state when showing success page
            startCountdown();
        }

        function startCountdown() {
            let seconds = 5;
            const countdownEl = document.getElementById('countdown');
            
            const updateCountdown = () => {
                countdownEl.textContent = `Returning in ${seconds} seconds...`;
                seconds--;
                
                if (seconds < 0) {
                    APP.currentUserType = '';
                    document.querySelectorAll('.user-type-btn').forEach(btn => btn.classList.remove('active'));
                    showPage('userTypeSelect');
                    saveSessionState(); // Save state when countdown completes
                } else {
                    setTimeout(updateCountdown, 1000);
                }
            };
            
            updateCountdown();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function doGoBack() {
            showPage('userTypeSelect');
            saveSessionState(); // Save state when going back
        }

        function adminReset() {
            // Only allow admin reset if user is logged in
            if (!APP.company || APP.company === '') {
                return; // Do nothing if not logged in
            }
            
            APP.adminClicks++;
            setTimeout(() => { APP.adminClicks = 0; }, 2000);
            if (APP.adminClicks >= 3) {
                // Clear location data
                APP.currentBusiness = '';
                APP.currentUserType = '';
                document.getElementById('businessDropdown').value = '';
                document.querySelectorAll('.user-type-btn').forEach(btn => btn.classList.remove('active'));
                
                // Remove location backgrounds and reset location display
                document.body.classList.remove('location-the-royal', 'location-the-crown', 'location-seabreeze');
                document.getElementById('locationName').style.display = 'none';
                document.getElementById('locationName').textContent = '';
                
                // Update header to show company but no location
                updateHeader();
                
                // Update session
                saveSessionState();
                
                showPage('businessSelect');
            }
        }

        // Logout timer functionality
        let logoutTimer = null;
        let logoutProgress = 0;

        function startLogoutTimer() {
            const logo = document.getElementById('headerLogo');
            if (!logo || logo.style.display === 'none') return;
            
            logoutProgress = 0;
            
            logoutTimer = setInterval(() => {
                logoutProgress += 100; // 100ms intervals
                
                // Visual feedback - darken the logo progressively
                const opacity = 1 - (logoutProgress / 6000) * 0.7; // Darken to 30% opacity
                logo.style.opacity = opacity;
                
                if (logoutProgress >= 6000) { // 6 seconds
                    performLogout();
                    cancelLogoutTimer();
                }
            }, 100);
        }

        function cancelLogoutTimer() {
            if (logoutTimer) {
                clearInterval(logoutTimer);
                logoutTimer = null;
                
                // Reset logo appearance
                const logo = document.getElementById('headerLogo');
                if (logo) {
                    logo.style.opacity = 1;
                }
            }
        }

        function performLogout() {
            // Reset all APP data
            APP.currentBusiness = '';
            APP.currentUserType = '';
            APP.company = '';
            APP.locations = [];
            
            // Reset UI elements
            document.getElementById('businessDropdown').value = '';
            document.querySelectorAll('.user-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('headerTitle').textContent = 'üëã HelloHub';
            document.getElementById('headerSubtitle').textContent = 'Visitor, Client & Staff Management';
            
            // Remove all background classes and hide logo
            document.body.classList.remove('alex-davis-logged-in');
            document.body.classList.remove('location-the-royal', 'location-the-crown', 'location-seabreeze');
            document.getElementById('headerLogo').style.display = 'none';
            document.getElementById('headerLogo').style.opacity = 1;
            
            // Clear session data
            localStorage.removeItem('hellohubSession');
            
            // Go back to login page
            showPage('loginPage');
        }

        // Initialize when page loads
        console.log('Script loaded successfully');
        console.log('Login: office@alexdavis.co.uk / office927');
        
        // Add Enter key support
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('emailAddress').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') doLogin();
            });
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') doLogin();
            });
            
            // Restore session state from localStorage
            restoreSessionState();
        });

        // Save current state to localStorage
        function saveSessionState() {
            const sessionState = {
                company: APP.company,
                locations: APP.locations,
                currentBusiness: APP.currentBusiness,
                currentUserType: APP.currentUserType,
                isLoggedIn: APP.company !== '',
                currentPage: getCurrentActivePage(),
                // Save departing visitor data for feedback page restoration
                currentDepartingVisitor: currentDepartingVisitor
            };
            localStorage.setItem('hellohubSession', JSON.stringify(sessionState));
        }

        // Get current active page
        function getCurrentActivePage() {
            const activePages = document.querySelectorAll('.page.active');
            if (activePages.length > 0) {
                return activePages[0].id;
            }
            return 'loginPage';
        }

        // Restore session state from localStorage
        function restoreSessionState() {
            const savedSession = localStorage.getItem('hellohubSession');
            
            // Check if this is a fresh browser session (new tab/window)
            const isNewBrowserSession = !sessionStorage.getItem('hellohubActive');
            
            // Mark this browser tab as active
            sessionStorage.setItem('hellohubActive', 'true');
            
            if (savedSession) {
                try {
                    const sessionState = JSON.parse(savedSession);
                    
                    // Check if we have a complete, valid session
                    const hasCompleteSession = sessionState.isLoggedIn && 
                                              sessionState.company && 
                                              sessionState.locations && 
                                              sessionState.locations.length > 0;
                    
                    if (hasCompleteSession) {
                        console.log('Valid session found. New browser session:', isNewBrowserSession);
                        
                        if (isNewBrowserSession) {
                            // Fresh URL entry: Start at login page
                            console.log('Fresh URL entry detected, starting at login page');
                            localStorage.removeItem('hellohubSession');
                            resetToLoginPage();
                        } else {
                            // Browser refresh: Restore full state
                            console.log('Browser refresh detected, restoring full state');
                            
                            // Always restore the login and location data
                            APP.company = sessionState.company;
                            APP.locations = sessionState.locations;
                            APP.currentBusiness = sessionState.currentBusiness || '';
                            APP.currentUserType = sessionState.currentUserType || '';
                            
                            // Restore departing visitor data if it exists
                            if (sessionState.currentDepartingVisitor) {
                                currentDepartingVisitor = sessionState.currentDepartingVisitor;
                            }
                            
                            // Setup UI
                            setupBusinessDropdown();
                            if (APP.currentBusiness) {
                                document.getElementById('businessDropdown').value = APP.currentBusiness;
                                updateHeader();
                            }
                            
                            // Restore user type selection if it exists
                            if (APP.currentUserType) {
                                document.querySelectorAll('.user-type-btn').forEach(btn => {
                                    btn.classList.remove('active');
                                    if (btn.onclick.toString().includes(`'${APP.currentUserType}'`)) {
                                        btn.classList.add('active');
                                    }
                                });
                            }
                            
                            // Restore exact page they were on - with proper form rebuilding
                            if (sessionState.currentPage && sessionState.currentPage !== 'loginPage') {
                                showPageWithoutSaving(sessionState.currentPage);
                                
                                // Rebuild forms if necessary
                                if (sessionState.currentPage === 'arrivingPage') {
                                    buildArrivalForm();
                                } else if (sessionState.currentPage === 'leavingPage') {
                                    buildDepartureForm();
                                } else if (sessionState.currentPage === 'feedbackPage') {
                                    setupStarRatings();
                                } else if (sessionState.currentPage === 'successPage') {
                                    // If on success page, redirect to user type selection instead
                                    // Success page is temporary and shouldn't be restored
                                    showPageWithoutSaving('userTypeSelect');
                                }
                            } else {
                                // Only use fallback logic if no currentPage was saved
                                if (APP.currentBusiness) {
                                    showPageWithoutSaving('userTypeSelect');
                                } else {
                                    showPageWithoutSaving('businessSelect');
                                }
                            }
                        }
                    } else {
                        console.log('Invalid or incomplete session, starting fresh');
                        localStorage.removeItem('hellohubSession');
                        resetToLoginPage();
                    }
                } catch (error) {
                    console.log('Error parsing session, starting fresh');
                    localStorage.removeItem('hellohubSession');
                    resetToLoginPage();
                }
            } else {
                console.log('No saved session, starting at login page');
                resetToLoginPage();
            }
        }

        // Reset everything to login page state
        function resetToLoginPage() {
            APP.company = '';
            APP.locations = [];
            APP.currentBusiness = '';
            APP.currentUserType = '';
            
            document.getElementById('headerTitle').textContent = 'üëã HelloHub';
            document.getElementById('headerSubtitle').textContent = 'Visitor, Client & Staff Management';
            document.getElementById('locationName').style.display = 'none';
            document.getElementById('headerLogo').style.display = 'none';
            
            document.body.classList.remove('alex-davis-logged-in');
            document.body.classList.remove('location-the-royal', 'location-the-crown', 'location-seabreeze');
            
            showPageWithoutSaving('loginPage');
        }

        // Helper function to show page without saving state (to avoid recursion during restore)
        function showPageWithoutSaving(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }
    </script>
</body>
</html>
